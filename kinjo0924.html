<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ãã‚“ã‚†ã†å¥³å­ï½œMVPãƒ¢ãƒƒã‚¯ï¼ˆæ˜¨æ—¥ã®çµæœï¼‹è±†çŸ¥è­˜ / 5:00æ›´æ–°ï¼‰</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { theme:{ extend:{ colors:{ primary:"#8ddcd1", primaryDark:"#5bb9ab" } } } }
  </script>
  <style>
    :root { --primary:#8ddcd1; --ink:#083b37; }
    .btn-primary{ background:var(--primary); color:var(--ink); font-weight:700; }
    .btn-primary:hover{ filter:brightness(0.97); }
    .btn-outline{ border-color:var(--primary); color:var(--ink); }
    .btn-outline:hover{ background:rgba(141,220,209,.15); }
    .ring-today{ box-shadow:0 0 0 2px #111 inset; border-radius:12px; }
    .tab-active{ background:var(--primary); color:var(--ink); font-weight:700; }
    .tab-inactive{ background:#f3f4f6; color:#111; }
    .choice-btn{ border:2px solid var(--primary); background:#fff; border-radius:14px; padding:12px; text-align:center; font-weight:700; }
    .choice-btn:active{ background:rgba(141,220,209,.15); transform:translateY(1px); }
  </style>
</head>
<body class="bg-neutral-50 text-neutral-900">
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="px-4 py-3 border-b bg-white sticky top-0 z-10 flex items-center justify-between">
    <div class="font-bold">ãã‚“ã‚†ã†å¥³å­ï¼ˆMVPãƒ¢ãƒƒã‚¯ï¼‰</div>
    <div class="text-xs text-neutral-500">å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ: <span id="pts" class="font-semibold">1,200</span>pt</div>
  </header>

  <!-- æœ¬æ–‡ -->
  <main class="max-w-3xl mx-auto p-4 pb-28">
    <!-- HOMEï¼ˆç›®æ¨™å®¶è¨ˆç°¿ï¼‰ -->
    <section id="home" class="space-y-4">
      <!-- ç›®æ¨™ã‚«ãƒ¼ãƒ‰ -->
      <section class="bg-white rounded-2xl shadow-sm p-4 grid grid-cols-[64px_1fr] gap-3 items-center">
        <div class="relative w-16 h-16">
          <div id="ringFill" class="absolute inset-0 rounded-full" style="background: linear-gradient(135deg, #b9eee6, var(--primary));"></div>
          <div class="absolute inset-1 rounded-full bg-white flex items-center justify-center text-sm font-bold" id="progressTxt">27%</div>
        </div>
        <div>
          <div class="font-semibold">ğŸ¯ æµ·å¤–æ—…è¡Œ 300,000å†† / æœŸé™ 2025-12-31</div>
          <div class="text-xs text-neutral-500">æ®‹ã‚Š 218,000å††</div>
          <div class="mt-1 text-sm">AIã²ã¨è¨€ï¼šå°ã•ãªä¸€æ­©ãŒç©ã¿é‡ãªã£ã¦ã„ã¾ã™ã€‚ä»Šæ—¥ã¯ãƒ¡ãƒ¢ã ã‘ã§ã‚‚OKã€‚</div>
        </div>
      </section>

      <!-- â–¼ ä¸¦ã³é †ï¼šã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ â†’ å…¥åŠ› â–¼ -->

      <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼ˆæ‰¿èªãƒ•ãƒ­ãƒ¼ãªã—ï¼‰ -->
      <section class="bg-white rounded-2xl shadow-sm p-4">
        <div class="flex items-center justify-between mb-2">
          <button id="prevMonth" class="text-sm px-2 py-1">â†</button>
          <div id="monthLabel" class="font-semibold"></div>
          <button id="nextMonth" class="text-sm px-2 py-1">â†’</button>
        </div>
        <div class="grid grid-cols-7 gap-2 text-center text-xs text-neutral-500 mb-1">
          <div>æ—¥</div><div>æœˆ</div><div>ç«</div><div>æ°´</div><div>æœ¨</div><div>é‡‘</div><div>åœŸ</div>
        </div>
        <div id="calendar" class="grid grid-cols-7 gap-2"></div>
        <div class="mt-2 text-xs text-neutral-500">â—æ—¥è¨˜ ğŸ“±è«‹æ±‚ ğŸ’¼çµ¦æ–™ ï¼ â– è¨˜éŒ²ã‚ã‚Š ï¼ â–£ä»Šæ—¥</div>
      </section>

      <!-- å…¥åŠ›ãƒœãƒƒã‚¯ã‚¹ -->
      <section class="bg-white rounded-2xl shadow-sm p-4 space-y-3">
        <div class="grid grid-cols-3 gap-2">
          <input id="inAmount" placeholder="é‡‘é¡ï¼ˆç©ºã§ã‚‚OKï¼‰" class="col-span-1 px-3 py-2 border rounded-xl"/>
          <input id="inNote" placeholder="ãƒ¡ãƒ¢ï¼ˆ1è¡Œï¼‰" class="col-span-2 px-3 py-2 border rounded-xl"/>
        </div>
        <div class="flex gap-2 text-xs">
          <button data-tag="saving" class="tag-btn px-3 py-1 rounded-full border tab-active">è²¯é‡‘</button>
          <button data-tag="expense" class="tag-btn px-3 py-1 rounded-full border tab-inactive">æ”¯å‡º</button>
          <button data-tag="bill" class="tag-btn px-3 py-1 rounded-full border tab-inactive">è«‹æ±‚</button>
          <button data-tag="income" class="tag-btn px-3 py-1 rounded-full border tab-inactive">çµ¦æ–™</button>
          <div class="ml-auto">
            <button id="btnSaveLog" class="px-4 py-2 rounded-xl btn-primary">ä¿å­˜ +10pt</button>
          </div>
        </div>
      </section>

      <!-- æ—¥è¨˜ -->
      <section class="bg-white rounded-2xl shadow-sm p-4 space-y-2">
        <div class="text-sm font-semibold">ä»Šæ—¥ã®æ—¥è¨˜ï¼ˆ50â€“120å­—ãƒ»é‡‘é¡ã¯å…¬é–‹ã•ã‚Œã¾ã›ã‚“ï¼‰</div>
        <textarea id="diary" rows="3" maxlength="120" placeholder="ä¾‹ï¼šã‚«ãƒ•ã‚§ã¯1å›ã«ã€‚æ­©ã„ã¦å¸°ã£ãŸã€‚" class="w-full px-3 py-2 border rounded-xl"></textarea>
        <div class="flex items-center gap-2 text-xs">
          <select class="px-2 py-1 border rounded-lg">
            <option>å…¬é–‹ç¯„å›²ï¼šå…¨ä½“</option>
            <option>å…¬é–‹ç¯„å›²ï¼šé™å®š</option>
            <option>å…¬é–‹ç¯„å›²ï¼šè‡ªåˆ†ã®ã¿</option>
          </select>
          <button id="btnPostDiary" class="ml-auto px-4 py-2 rounded-xl btn-primary">æŠ•ç¨¿ +6pt</button>
        </div>
      </section>

      <div class="text-center">
        <button id="toInvest" class="px-6 py-3 rounded-2xl btn-primary font-bold shadow">ä»Šæ—¥ã®è¨˜éŒ²ã§ç²å¾—ãƒã‚¤ãƒ³ãƒˆ â†’ æŠ•è³‡ãƒ»å‹‰å¼·ã¸</button>
      </div>
    </section>

    <!-- INVESTï¼ˆæŠ•è³‡ãƒ»å‹‰å¼·ï¼‰ -->
    <section id="invest" class="hidden space-y-4">
      <!-- æ˜¨æ—¥ã®çµæœï¼‹è±†çŸ¥è­˜ï¼ˆåˆå¿ƒè€…å‘ã‘ï¼‰ -->
      <section class="bg-primary/20 border border-primary rounded-2xl p-4">
        <div class="flex items-start gap-3">
          <div class="text-xl">ğŸ“ˆ</div>
          <div class="flex-1">
            <div class="text-xs text-neutral-600">æ˜¨æ—¥ã®çµæœï¼ˆ5:00æ›´æ–°æ¸ˆã¿ï¼‰</div>
            <div class="font-bold text-lg" id="yTitle">1996å¹´ï½œé¸æŠï¼šæ ª100% â†’ çµæœï¼š+5%</div>
            <div class="text-sm mt-1" id="yDesc">ãƒã‚¤ãƒ³ãƒˆåæ˜ ï¼š+5%ï¼ˆå­¦ç¿’ãƒã‚¤ãƒ³ãƒˆã¯æ•™è‚²ç”¨ã®æ•°å€¤ã§ã™ï¼‰</div>
            <details class="mt-2">
              <summary class="text-sm font-semibold cursor-pointer">ğŸ’¡è±†çŸ¥è­˜ï¼ˆåˆå¿ƒè€…å‘ã‘ï¼‰</summary>
              <div class="text-sm mt-1" id="yTip">
                æ ªã¯ä¼šç¤¾ã®å°†æ¥ã«æŠ•è³‡ã™ã‚‹è³‡ç”£ã€‚é‡‘åˆ©ãŒä½ã„æ™‚æœŸã¯ã€ä¼æ¥­ãŒå€Ÿå…¥ã—ã‚„ã™ãæˆé•·ã—ã‚„ã™ã„ï¼æ ªãŒæœ‰åˆ©ãªã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
              </div>
            </details>
          </div>
        </div>
        <p class="text-xs text-neutral-600 mt-2">â€»æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯å­¦ç¿’ç”¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚å®Ÿéš›ã®æŠ•è³‡æ¨å¥¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
      </section>

      <!-- ãƒ«ãƒ¼ãƒ«æ¡ˆå†… -->
      <section class="bg-white rounded-2xl shadow-sm p-4">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
          <div>
            <div class="text-xs text-neutral-500">ä»Šæ—¥ã®å¹´ï¼ˆå›ç­”å¾Œã®çµæœã¯æ˜æœ5:00ã«è¡¨ç¤ºï¼‰</div>
            <div class="text-xl font-bold"><span id="yearTxt"></span>å¹´ <span id="badge" class="ml-2 text-sm"></span></div>
          </div>
          <div class="text-sm text-neutral-600">å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆï¼š<b><span id="pts2">1,200</span>pt</b></div>
        </div>
      </section>

      <!-- æ¨ªä¸‰æŠï¼ˆã‚¹ãƒãƒ›ã§ã‚‚æ¨ªä¸¦ã³ï¼‰ -->
      <section id="choices" class="flex gap-2"></section>

      <!-- ãƒ’ãƒ³ãƒˆ -->
      <section id="hintBox" class="hidden bg-primary/20 border border-primary text-[#083b37] rounded-2xl p-4 text-sm">
        <div class="font-semibold mb-1">ãƒ’ãƒ³ãƒˆ</div>
        <ul id="hintList" class="list-disc ml-5 space-y-1"></ul>
        <div class="text-xs mt-2 text-neutral-600">â€»ãƒ’ãƒ³ãƒˆã¯äº‹å®Ÿã®èƒŒæ™¯ã‚’å­¦ã¶ãŸã‚ã®ã‚‚ã®ã§ã™ï¼ˆç­”ãˆãã®ã‚‚ã®ã¯å‡ºã—ã¾ã›ã‚“ï¼‰ã€‚</div>
      </section>

      <div class="flex gap-2">
        <button id="btnHint" class="px-3 py-2 rounded-xl btn-outline border-2 text-sm">ãƒ’ãƒ³ãƒˆã‚’è¦‹ã‚‹</button>
        <button class="px-3 py-2 rounded-xl border text-sm" onclick="switchTab('home')">å®¶è¨ˆç°¿ã«æˆ»ã‚‹</button>
      </div>

      <!-- å—ä»˜å®Œäº†ï¼ˆçµæœã¯ç¿Œæœï¼‰ -->
      <section id="pendingBox" class="hidden bg-white rounded-2xl shadow-sm p-4">
        <div class="text-sm">ä»Šæ—¥ã®å›ç­”ï¼š<b id="pendingChoice">-</b> ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€‚</div>
        <div class="mt-1 text-amber-700 text-sm">ğŸ•” çµæœã¯ <b>æ˜æ—¥ã®æœ 5:00</b> ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
        <div class="mt-2 text-xs text-neutral-600">â€»æ•™è‚²ç”¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼šçµæœã¯å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆã«åæ˜ ã•ã‚Œã¾ã™ã€‚</div>
      </section>

      <!-- ãƒŸãƒ‹ãƒ»ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰ -->
      <section class="bg-white rounded-2xl shadow-sm p-4">
        <div class="text-sm font-semibold mb-2">ãƒŸãƒ‹ãƒ»ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰</div>
        <ol class="text-sm space-y-1">
          <li>1ä½ ã¿ã‚†: 1,980pt</li>
          <li>2ä½ ã‚ã‹ã­: 1,720pt</li>
          <li>3ä½ ã‚ã‚„: 1,540pt</li>
          <li>ã‚ãªãŸ: <span id="pts4">1,200</span>pt</li>
        </ol>
      </section>
    </section>

    <!-- TIMELINEï¼ˆè¿”ä¿¡ä¾‹ã‚ã‚Šï¼‰ -->
    <section id="timeline" class="hidden space-y-4">
      <section class="bg-white rounded-2xl shadow-sm p-4 space-y-2">
        <div class="text-sm font-semibold">çŸ­æ—¥è¨˜ã‚’æŠ•ç¨¿ï¼ˆ50â€“120å­—ï¼‰â€»é‡‘é¡ã¯å…¬é–‹ã•ã‚Œã¾ã›ã‚“</div>
        <textarea rows="3" maxlength="120" placeholder="ä¾‹ï¼šä»Šæ—¥ã¯å¯„ã‚Šé“ã›ãšå¸°å®…ï¼" class="w-full px-3 py-2 border rounded-xl"></textarea>
        <div class="flex items-center gap-2 text-xs">
          <select class="px-2 py-1 border rounded-lg">
            <option>å…¬é–‹ç¯„å›²ï¼šå…¨ä½“</option>
            <option>å…¬é–‹ç¯„å›²ï¼šé™å®š</option>
            <option>å…¬é–‹ç¯„å›²ï¼šè‡ªåˆ†ã®ã¿</option>
          </select>
          <button class="ml-auto px-4 py-2 rounded-xl btn-primary">æŠ•ç¨¿</button>
        </div>
      </section>

      <section class="space-y-3" id="feed"></section>
    </section>
  </main>

  <!-- ä¸‹ã‚¿ãƒ–ãƒŠãƒ“ï¼ˆå›ºå®šï¼‰ -->
  <nav class="fixed bottom-0 inset-x-0 bg-white border-t p-2 grid grid-cols-3 gap-2 z-10">
    <button data-tab="home" class="nav-btn py-2 rounded-xl tab-active">ç›®æ¨™å®¶è¨ˆç°¿</button>
    <button data-tab="invest" class="nav-btn py-2 rounded-xl tab-inactive">æŠ•è³‡ãƒ»å‹‰å¼·</button>
    <button data-tab="timeline" class="nav-btn py-2 rounded-xl tab-inactive">ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</button>
  </nav>

  <script>
    // ====== çŠ¶æ…‹ ======
    let points = 1200;
    let tag = "saving";
    let today = new Date();
    const YEARS = [1973, 1996, 2008];
    let dayIdx = 0, hintLevel = 0, answeredToday = false;

    // æ˜¨æ—¥ã®çµæœï¼ˆãƒ€ãƒŸãƒ¼åˆæœŸå€¤ï¼‰
    let yesterday = { year: 1996, choice: "æ ª100%", ret: +5, tip: "æ ªã¯ä¼šç¤¾ã®å°†æ¥ã«æŠ•è³‡ã€‚é‡‘åˆ©ãŒä½ã„æ™‚æœŸã¯ä¼æ¥­ã®è³‡é‡‘èª¿é”ãŒã—ã‚„ã™ãã€æ ªãŒæœ‰åˆ©ã«ãªã‚Šã‚„ã™ã„ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚" };

    const HINTS = {
      1973:{ badge:"â›½ï¸ ã‚ªã‚¤ãƒ«ã‚·ãƒ§ãƒƒã‚¯",
        beginner:["ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼šåŸæ²¹ãƒ»ä¾›çµ¦ä¸å®‰","ç‰©ä¾¡ãŒä¸ŠãŒã‚Šã‚„ã™ãã€æ™¯æ°—ã¯å†·ãˆã‚„ã™ã„æ™‚æœŸã€‚","ã‚¤ãƒ³ãƒ•ãƒ¬æ™‚ã«å¼·ã„è³‡ç”£ã‚’æ€ã„å‡ºãã†ã€‚"],
        advanced:["ã‚³ã‚¹ãƒˆãƒ—ãƒƒã‚·ãƒ¥/ã‚¹ã‚¿ã‚°ãƒ•æ‡¸å¿µ","é‡‘åˆ©ä¸Šæ˜‡ã§ãƒãƒªãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³åœ§è¿«","å®Ÿç‰©è³‡ç”£ã¨ãƒ‡ã‚£ãƒ•ã‚§ãƒ³ã‚·ãƒ–ã®ä½¿ã„åˆ†ã‘"],
        learn:"åŸæ²¹ä¾›çµ¦ã‚·ãƒ§ãƒƒã‚¯ã§ã‚¤ãƒ³ãƒ•ãƒ¬åœ§åŠ›ãŒé«˜ã¾ã‚Šã€æ ªã¯å‰²å¼•ç‡ä¸Šæ˜‡ã§é€†é¢¨ã€‚é‡‘ãªã©å®Ÿç‰©è³‡ç”£ã®å½¹å‰²ã‚’ç¢ºèªã€‚"},
      1996:{ badge:"ğŸ§¦ ã‚³ã‚®ãƒ£ãƒ«/æ¸‹è°·",
        beginner:["æµè¡Œã®å¹´ã€‚ç‰©ä¾¡ã¯ä¸ŠãŒã‚Šã«ãã„æ™‚æœŸã€‚","é‡‘åˆ©ã¯ä½ã‚ã€‚å®ˆã‚Šã®è³‡ç”£ã‚‚æ€ã„å‡ºãã†ã€‚","ç‚ºæ›¿/æ”¿ç­–ã§æ ªãŒæ•æ„Ÿã€‚åˆ†æ•£ã‚’æ„è­˜ã€‚"],
        advanced:["ä½ã‚¤ãƒ³ãƒ•ãƒ¬/ä½é‡‘åˆ©ãƒ¬ã‚¸ãƒ¼ãƒ ","å®Ÿè³ªé‡‘åˆ©ãƒ»ç‚ºæ›¿ã®å¤‰åŒ–ã«æ³¨æ„","ãƒ˜ãƒƒã‚¸ã¨ãƒªãƒãƒ©ãƒ³ã‚¹ã«ç•™æ„"],
        learn:"90å¹´ä»£åŠã°ã¯ä½ã‚¤ãƒ³ãƒ•ãƒ¬ãƒ»ä½é‡‘åˆ©ãŒç¶šãã€æ ªã¯å¤–éƒ¨è¦å› ã«æ•æ„Ÿã€‚å‚µåˆ¸ã®ä¸‹æ”¯ãˆã‚„é‡‘ã®ãƒ˜ãƒƒã‚¸ã‚‚å­¦ã¹ã‚‹ã€‚"},
      2008:{ badge:"ğŸ§± é‡‘èå±æ©Ÿ",
        beginner:["ä¿¡ç”¨ãŒç¸®ã‚€å¹´","æ ªã¯å¤§ããæºã‚Œã‚„ã™ã„","å®ˆã‚Šã¨åˆ†æ•£ã‚’æ„è­˜"],
        advanced:["ãƒ‡ãƒ¬ãƒãƒ¬ãƒƒã‚¸","æ”¿ç­–é‡‘åˆ©ä½ä¸‹â†’å›½å‚µé‡‘åˆ©ä½ä¸‹","ç›¸é–¢å¤‰åŒ–ã«æ³¨æ„"],
        learn:"ãƒ¬ãƒãƒ¬ãƒƒã‚¸ã®å·»ãæˆ»ã—ã§ãƒªã‚¹ã‚¯è³‡ç”£ã¯ä¸‹è½ã€‚å®‰å…¨è³‡ç”£ã®ã‚¯ãƒƒã‚·ãƒ§ãƒ³ã‚„ç›¸é–¢ã®å¤‰åŒ–ã‚’å­¦ã¶ã€‚"}
    };
    const YEAR_RET = {1973:{equity:-17,bond:-6,gold:60},1996:{equity:5,bond:3,gold:-5},2008:{equity:-40,bond:7,gold:5}};
    const BEGIN = [
      { id:"EQUITY", label:"æ ª100%", retKey:"equity" },
      { id:"BOND",   label:"å‚µåˆ¸100%", retKey:"bond" },
      { id:"GOLD",   label:"é‡‘100%",   retKey:"gold" }
    ];
    const ADV = {
      1973:[{id:"A",label:"æ ª30%+å‚µ20%+é‡‘50%",mix:{equity:0.3,bond:0.2,gold:0.5}},
            {id:"B",label:"æ ª40%+é‡‘60%",      mix:{equity:0.4,bond:0.0,gold:0.6}},
            {id:"C",label:"å‚µ60%+é‡‘40%",      mix:{equity:0.0,bond:0.6,gold:0.4}}],
      1996:[{id:"A",label:"æ ª70%+å‚µ30%",      mix:{equity:0.7,bond:0.3,gold:0.0}},
            {id:"B",label:"æ ª50%+é‡‘50%",      mix:{equity:0.5,bond:0.0,gold:0.5}},
            {id:"C",label:"å‚µ40%+é‡‘60%",      mix:{equity:0.0,bond:0.4,gold:0.6}}],
      2008:[{id:"A",label:"å‚µ70%+é‡‘30%",      mix:{equity:0.0,bond:0.7,gold:0.3}},
            {id:"B",label:"æ ª20%+å‚µ40%+é‡‘40%",mix:{equity:0.2,bond:0.4,gold:0.4}},
            {id:"C",label:"æ ª40%+å‚µ60%",      mix:{equity:0.4,bond:0.6,gold:0.0}}]
    };

    // ====== UTILS ======
    const el = id => document.getElementById(id);
    const fmt = n => n.toLocaleString("ja-JP");
    function ymd(d){ return d.toISOString().slice(0,10); }

    // ã‚¿ãƒ–ï¼ˆä¸‹ãƒŠãƒ“ï¼‰
    function switchTab(name){
      ["home","invest","timeline"].forEach(t=> el(t).classList.toggle("hidden", t!==name));
      document.querySelectorAll(".nav-btn").forEach(btn=>{
        const active = btn.dataset.tab===name;
        btn.classList.toggle("tab-active", active);
        btn.classList.toggle("tab-inactive", !active);
      });
      if(name==="invest") renderInvest();
      if(name==="timeline") renderFeed();
    }
    document.querySelectorAll(".nav-btn").forEach(b=> b.addEventListener("click", ()=> switchTab(b.dataset.tab)));

    // ãƒã‚¤ãƒ³ãƒˆè¡¨ç¤º
    function drawPoints(){ ["pts","pts2","pts4"].forEach(id=>{ if(el(id)) el(id).textContent = fmt(points); }); }
    drawPoints();

    // é€²æ—ãƒªãƒ³ã‚°ï¼ˆãƒ€ãƒŸãƒ¼27%ï¼‰
    function drawRing(p=27){
      el("ringFill").style.clipPath = `inset(${100 - p}% 0 0 0)`;
      el("progressTxt").textContent = p + "%";
    }
    drawRing(27);

    // ã‚¿ã‚°é¸æŠ
    document.querySelectorAll(".tag-btn").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        document.querySelectorAll(".tag-btn").forEach(b=>{ b.classList.remove("tab-active"); b.classList.add("tab-inactive"); });
        btn.classList.remove("tab-inactive"); btn.classList.add("tab-active");
        tag = btn.dataset.tag;
      });
    });

    // ä¿å­˜ +10pt
    el("btnSaveLog").addEventListener("click", ()=>{ points += 10; drawPoints(); alert("ä¿å­˜ã—ã¾ã—ãŸï¼ˆãƒ€ãƒŸãƒ¼ã€‚+10ptï¼‰"); });

    // æ—¥è¨˜ +6pt
    el("btnPostDiary").addEventListener("click", ()=>{ points += 6; drawPoints(); el("diary").value=""; alert("æŠ•ç¨¿ã—ã¾ã—ãŸï¼ˆãƒ€ãƒŸãƒ¼ã€‚+6ptï¼‰"); });

    // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
    let viewY = today.getFullYear(), viewM = today.getMonth();
    function monthMatrix(y,m){
      const first=new Date(y,m,1), last=new Date(y,m+1,0);
      const start=first.getDay(), days=last.getDate(), out=[];
      for(let i=0;i<start;i++) out.push(null);
      for(let d=1; d<=days; d++) out.push(new Date(y,m,d));
      while(out.length%7!==0) out.push(null);
      return out;
    }
    function renderCalendar(){
      el("monthLabel").textContent = `${viewY}å¹´ ${viewM+1}æœˆ`;
      const grid=el("calendar"); grid.innerHTML="";
      monthMatrix(viewY, viewM).forEach(d=>{
        const box=document.createElement("div");
        box.className="aspect-square rounded-xl relative border bg-white border-neutral-200";
        if(d){
          const isToday = ymd(d)===ymd(today);
          if(isToday) box.classList.add("ring-today");
          if(isToday){
            box.classList.add("bg-primary/20","border-primary");
            const dotDiary=document.createElement("span");
            dotDiary.className="w-2 h-2 bg-sky-500 rounded-full absolute bottom-1 left-1";
            box.appendChild(dotDiary);
          }
          const label=document.createElement("div");
          label.className="absolute top-1 left-2 text-xs"; label.textContent=d.getDate();
          box.appendChild(label);
        }
        grid.appendChild(box);
      });
    }
    renderCalendar();
    el("prevMonth").onclick = ()=>{ viewM===0 ? (viewY--, viewM=11) : viewM--; renderCalendar(); };
    el("nextMonth").onclick = ()=>{ viewM===11? (viewY++, viewM=0) : viewM++; renderCalendar(); };

    // æŠ•è³‡ã‚¿ãƒ–
    function currentYear(){ return YEARS[dayIdx % YEARS.length]; }
    function isAdvanced(){ return points >= 1500 || dayIdx >= 2; }

    function renderYesterdayBanner(){
      el("yTitle").textContent = `${yesterday.year}å¹´ï½œé¸æŠï¼š${yesterday.choice} â†’ çµæœï¼š${yesterday.ret>0?"+":""}${yesterday.ret}%`;
      el("yDesc").textContent = `ãƒã‚¤ãƒ³ãƒˆåæ˜ ï¼š${yesterday.ret>0?"+":""}${yesterday.ret}%ï¼ˆå­¦ç¿’ãƒã‚¤ãƒ³ãƒˆã¯æ•™è‚²ç”¨ã®æ•°å€¤ã§ã™ï¼‰`;
      el("yTip").textContent = yesterday.tip;
    }

    function renderInvest(){
      renderYesterdayBanner();
      const yr = currentYear(), pack = HINTS[yr];
      el("yearTxt").textContent = yr;
      el("badge").textContent = pack.badge;
      el("pts2").textContent = fmt(points);
      el("pendingBox").classList.add("hidden");
      hintLevel = 0; el("hintBox").classList.add("hidden"); el("hintList").innerHTML="";
      const chs = isAdvanced()? ADV[yr] : BEGIN;
      const wrap = el("choices"); wrap.innerHTML="";
      wrap.className = "flex gap-2";
      chs.forEach(c=>{
        const btn = document.createElement("button");
        btn.className = "choice-btn flex-1 min-w-0";
        btn.innerHTML = `<div class="text-xs text-neutral-500 font-normal">é¸æŠè‚¢</div>
                         <div class="text-base sm:text-lg">${c.label}</div>`;
        btn.onclick = ()=> onAnswer(c);
        wrap.appendChild(btn);
      });
    }

    function onAnswer(c){
      // å›ç­”ã®ã¿å—ã‘ä»˜ã‘ã€çµæœã¯ç¿Œæœã€‚ã“ã“ã§ã¯ pending ã‚’è¡¨ç¤ºã€‚
      answeredToday = true;
      el("pendingChoice").textContent = c.label;
      el("pendingBox").classList.remove("hidden");

      // ãƒ€ãƒŸãƒ¼ï¼šç¿Œæœã«è¡¨ç¤ºã•ã‚Œã‚‹ã€Œæ˜¨æ—¥ã®çµæœã€ã‚’å·®ã—æ›¿ãˆã‚‹ï¼ˆå³æ™‚ã«è¦‹ãŸç›®ã ã‘æ›´æ–°ï¼‰
      const yr = currentYear(), r = YEAR_RET[yr];
      let ret=0;
      if(c.mix){ ret = Math.round((c.mix.equity*r.equity + c.mix.bond*r.bond + c.mix.gold*r.gold)*10)/10; }
      else { ret = r[c.retKey]; }
      yesterday = {
        year: yr, choice: c.label, ret: ret,
        tip: (yr===1973? "ç‰©ã®å€¤æ®µãŒä¸ŠãŒã‚‹â€œã‚¤ãƒ³ãƒ•ãƒ¬â€ã®ã¨ãã¯ã€é‡‘ãªã©ã®å®Ÿç‰©è³‡ç”£ãŒå€¤æŒã¡ã—ã‚„ã™ã„ã¨è¨€ã‚ã‚Œã¾ã™ã€‚":
              yr===2008? "æ™¯æ°—ãŒæ‚ªããªã‚‹ã¨å®‰å…¨è³‡ç”£ãŒè²·ã‚ã‚Œã‚„ã™ãã€æ ªã¯å¤§ããä¸‹ãŒã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚åˆ†æ•£ãŒå¤§åˆ‡ã€‚":
                         "é‡‘åˆ©ãŒä½ã„ã¨ä¼æ¥­ãŒæŠ•è³‡ã‚’ã—ã‚„ã™ãã€æ ªä¾¡ã«ãƒ—ãƒ©ã‚¹ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚")
      };
      // ãƒã‚¤ãƒ³ãƒˆã¯ç¿Œæœåæ˜ ã®æƒ³å®šãªã®ã§ã€ã“ã“ã§ã¯å¢—æ¸›ã—ãªã„
      alert("å›ç­”ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸï¼çµæœã¯æ˜æ—¥ã®æœ5:00ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚");
    }

    el("btnHint").onclick = ()=>{
      hintLevel = Math.min(3, hintLevel+1);
      const yr = currentYear(), pack = HINTS[yr];
      const arr = (isAdvanced()? pack.advanced : pack.beginner).slice(0, hintLevel);
      const list = el("hintList"); list.innerHTML="";
      arr.forEach(t=>{ const li=document.createElement("li"); li.textContent=t; list.appendChild(li); });
      el("hintBox").classList.remove("hidden");
    };

    // ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ï¼ˆè¿”ä¿¡ã‚µãƒ³ãƒ—ãƒ«ï¼‰
    const FEED = [
      { user:"ğŸ± ã¿ã‚†", body:"å¤–é£Ÿã‚’1å›æˆ‘æ…¢ï¼æ—…è¡Œã¾ã§é ‘å¼µã‚‹ğŸ¥¤", heat:12, tags:["æ—…è¡Œ"],
        replies:[{user:"ğŸ¦Š ãªãŠ", body:"ç§ã‚‚ä»Šæ—¥ã¯æ‰‹ä½œã‚Šå¼å½“ã€œï¼", time:"3åˆ†å‰"},{user:"ğŸ¼ ã‚Šã“", body:"ãŒã‚“ã°ã‚Œã€œğŸ‘", time:"1åˆ†å‰"}] },
      { user:"ğŸ¦Š ãªãŠ", body:"ã‚³ãƒ³ãƒ“ãƒ‹ç«‹ã¡å¯„ã‚‰ãšå¸°å®…ãƒãƒ£ãƒ¬ãƒ³ã‚¸æˆåŠŸ", heat:8, tags:["ç¯€ç´„"],
        replies:[{user:"ğŸ± ã¿ã‚†", body:"ãˆã‚‰ã„ï¼ï¼", time:"5åˆ†å‰"}] },
      { user:"ğŸ¼ ã‚Šã“", body:"çµ¦æ–™æ—¥5%è‡ªå‹•è²¯é‡‘ã‚ªãƒ³ã«ã—ãŸâœï¸", heat:20, tags:["çµ¦æ–™æ—¥"], replies:[] }
    ];
    function renderFeed(){
      const box = el("feed"); box.innerHTML="";
      FEED.forEach(p=>{
        const art = document.createElement("article");
        art.className = "bg-white rounded-2xl shadow-sm p-4";
        const repliesHTML = p.replies.map(r =>
          `<div class="mt-2 pl-4 border-l-2 border-primary/60">
            <div class="text-sm"><span class="font-semibold">${r.user}</span> <span class="text-xs text-neutral-500">${r.time}</span></div>
            <div class="text-sm mt-1">${r.body}</div>
          </div>`).join("");
        art.innerHTML = `
          <div class="flex items-center justify-between">
            <div class="font-semibold">${p.user}</div>
            <div class="text-xs text-neutral-500">ã‚¿ã‚°: ${p.tags.join(" / ")}</div>
          </div>
          <div class="mt-1 text-sm">${p.body}</div>
          <div class="mt-2 flex items-center gap-2 text-sm">
            <button class="px-3 py-1 rounded-full border">â¤ï¸</button>
            <button class="px-3 py-1 rounded-full border">ãŒã‚“ã°ã‚Œ</button>
            <button class="px-3 py-1 rounded-full border">ğŸ‘</button>
            <div class="ml-auto text-xs text-neutral-500">æ¸©åº¦ ${p.heat}</div>
          </div>
          ${repliesHTML}
          <div class="mt-3 flex items-center gap-2">
            <input placeholder="è¿”ä¿¡ã‚’æ›¸ãâ€¦" class="flex-1 px-3 py-2 border rounded-xl text-sm"/>
            <button class="px-3 py-2 rounded-xl btn-primary text-sm">è¿”ä¿¡</button>
          </div>`;
        box.appendChild(art);
      });
    }

    // CTA
    document.getElementById("toInvest").onclick = ()=> switchTab("invest");

    // åˆæœŸæç”»
    renderCalendar();
    renderFeed();
  </script>
</body>
</html>
